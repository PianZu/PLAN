-- 9) Show workload of a professor (view + demo select)
CREATE OR REPLACE VIEW SCHEMA_MAIN.VW_PROFESSOR_WORKLOAD AS
SELECT
  a.ACADEMIC_STAFF_ID,
  a.FIRST_NAME,
  a.LAST_NAME,
  ca.COURSE_ASSIGNMENT_TERM AS TERM,
  DECIMAL(COALESCE(SUM(ca.TEACHING_HOURS), 0), 7, 2) AS TEACHING_LOAD,
  DECIMAL(COALESCE(w.ACADEMIC_STAFF_REDUCTION, 0), 7, 2) AS REDUCTION,
  DECIMAL(COALESCE(SUM(ca.TEACHING_HOURS), 0) - COALESCE(w.ACADEMIC_STAFF_REDUCTION, 0), 7, 2) AS NET_WORKLOAD
FROM SCHEMA_MAIN.ACADEMIC_STAFF a
LEFT JOIN SCHEMA_MAIN.COURSE_ASSIGNMENT ca
  ON ca.ACADEMIC_STAFF_ID = a.ACADEMIC_STAFF_ID
LEFT JOIN SCHEMA_MAIN.ACADEMIC_STAFF_WORKLOAD w
  ON w.ACADEMIC_STAFF_ID = a.ACADEMIC_STAFF_ID
 AND w.SEMESTER_NR = ca.COURSE_ASSIGNMENT_TERM
WHERE a.IS_PROF = TRUE
GROUP BY
  a.ACADEMIC_STAFF_ID, a.FIRST_NAME, a.LAST_NAME,
  ca.COURSE_ASSIGNMENT_TERM, w.ACADEMIC_STAFF_REDUCTION;

-- Demo: professor from Excel (999)
SELECT *
FROM SCHEMA_MAIN.VW_PROFESSOR_WORKLOAD
WHERE ACADEMIC_STAFF_ID = 999
ORDER BY TERM;