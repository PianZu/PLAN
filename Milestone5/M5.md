# Milestone 5 – DB2 Execution & Validation Scripts

This repository contains all SQL scripts required to demonstrate and validate the Milestone 5 business cases for the university course-planning system.

All scripts are designed to run directly on the DB2 database created by `create_staging.sql`.  
The base data is already loaded and **must not be modified manually** — only through the scripts below.

Each folder represents one business area from the Milestone-5 specification.

---

## Folder: `base_data_management`

This folder contains scripts that modify the **core staff and base structure** of the system.  
These scripts simulate real-world staff lifecycle events.

---

### `add_elective.txt`
Adds a new elective subject to the curriculum.

**Purpose**  
Simulates the academic decision to offer an additional optional module for a degree program.

**Affected tables**
- `SUBJECT`
- `COURSE`

---

### `hire_adjunct.txt`
Adds a new adjunct lecturer (non-professor) to the system.

**Purpose**  
Simulates hiring a new external lecturer.

**Affected tables**
- `ACADEMIC_STAFF`
- `LECTURER`
- `ACADEMIC_STAFF_WORKLOAD`

---

### `no_longer_available.txt`
Marks an adjunct lecturer as unavailable for a semester and removes their teaching assignments.

**Purpose**  
Simulates that a lecturer can no longer teach (e.g. contract ends or illness).

**Actions**
- Deletes rows from `COURSE_ASSIGNMENT`
- Inserts or updates `ACADEMIC_STAFF_WORKLOAD` with role `UNAVAILABLE`

---

### `prof_retires.txt`
Marks a professor as retired for a semester and removes their teaching assignments.

**Purpose**  
Simulates the retirement of a professor.

**Actions**
- Ensures a workload entry exists
- Sets `ACADEMIC_STAFF_ROLE = 'RETIRED'`
- Deletes all `COURSE_ASSIGNMENT` records for that professor in the semester

---

### `new_prof_hired.txt`
Adds a new professor to the system.

**Purpose**  
Simulates hiring a new permanent professor.

**Affected tables**
- `ACADEMIC_STAFF`
- `ACADEMIC_STAFF_WORKLOAD`

---

## Folder: `planning_offered_courses`

This folder contains scripts that control **which courses are offered and planned** for a term.

---

### `start_planning.txt`
Creates the planning context for a new semester.

**Purpose**  
Initializes planning for an upcoming term.

**Uses**
- `COURSE_ASSIGNMENT`
- `SUBJECT`
- `DEGREE_PROGRAM`

---

### `plan_dedicated_semester.txt`
Lists all subjects that belong to a specific semester of a degree program (e.g. SWB6).

**Purpose**  
Allows planners to see which modules must be scheduled for a semester.

---

### `alert_missing_courses.txt`
Finds mandatory subjects that are not yet offered in a given term.

**Purpose**  
Ensures that no required courses are missing from the semester plan.

---

### `show_workload.txt`
Shows the total workload of a professor for a term.

**Purpose**  
Used by planners to avoid over-allocating professors.

**Uses**
- `COURSE_ASSIGNMENT`
- `ACADEMIC_STAFF_WORKLOAD`

---

### `check_linked_courses.txt`
Detects duplicate course assignments that would cause double workload counting.

**Purpose**  
Ensures that the same course is not counted twice for the same lecturer.

**Logic**
```sql
GROUP BY (COURSE_ASSIGNMENT_TERM, SUBJECT_NR, DEGREE_SHORT_NAME, ACADEMIC_STAFF_ID)
HAVING COUNT(*) > 1
```
If this query returns zero rows, double counting does not occur.

---

## Folder: `reporting`

### `report_offered_courses.txt`

Produces a report of all offered courses per semester.

**Purpose**  
Used for faculty and rectorate reporting.

**Includes**
- Degree program
- Subject
- Lecturer
- Teaching hours

---

## Folder: `budgeting`

### `update_courses.txt`

Updates the teaching hours of course offerings at the end of a semester.

**Purpose**  
Reflects the actual delivered teaching for budgeting and payroll.

**Modifies**
- `COURSE_ASSIGNMENT.TEACHING_HOURS`

This represents the official end-of-term correction of the teaching budget.

---

### `workload_balance.txt`

Shows the overall workload balance of a professor, including reductions.

**Purpose**  
Used to verify whether a professor is under- or over-allocated.

**Uses**
- `COURSE_ASSIGNMENT`
- `ACADEMIC_STAFF_WORKLOAD`

---

## Execution

All scripts are executed using:

```bash
db2 -tvf <scriptname>.txt
