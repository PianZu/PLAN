-- Show the overall workload balance of a professor
-- ("balance" implemented as total teaching - total reductions; schema has no target/carryover)
CREATE OR REPLACE VIEW SCHEMA_MAIN.VW_PROFESSOR_TOTAL_NET AS
SELECT
  a.ACADEMIC_STAFF_ID,
  a.FIRST_NAME,
  a.LAST_NAME,
  DECIMAL(COALESCE(SUM(ca.TEACHING_HOURS), 0), 9, 2) AS TOTAL_TEACHING,
  DECIMAL(COALESCE(SUM(COALESCE(w.ACADEMIC_STAFF_REDUCTION, 0)), 0), 9, 2) AS TOTAL_REDUCTION,
  DECIMAL(
    COALESCE(SUM(ca.TEACHING_HOURS), 0) - COALESCE(SUM(COALESCE(w.ACADEMIC_STAFF_REDUCTION, 0)), 0),
  9, 2) AS TOTAL_NET
FROM SCHEMA_MAIN.ACADEMIC_STAFF a
LEFT JOIN SCHEMA_MAIN.COURSE_ASSIGNMENT ca
  ON ca.ACADEMIC_STAFF_ID = a.ACADEMIC_STAFF_ID
LEFT JOIN SCHEMA_MAIN.ACADEMIC_STAFF_WORKLOAD w
  ON w.ACADEMIC_STAFF_ID = a.ACADEMIC_STAFF_ID
 AND w.SEMESTER_NR = ca.COURSE_ASSIGNMENT_TERM
GROUP BY a.ACADEMIC_STAFF_ID, a.FIRST_NAME, a.LAST_NAME;

-- Demo: real professor ID from dataset
SELECT *
FROM SCHEMA_MAIN.VW_PROFESSOR_TOTAL_NET
WHERE ACADEMIC_STAFF_ID = 999;